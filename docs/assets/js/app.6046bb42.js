(function(){"use strict";var e={9645:function(e,n,t){var r=t(5130),s=t(6768),o=t(144),a=t(1387),i={class:"main-box"},c=(0,s.pM)({__name:"App",setup:function(e){return function(e,n){return(0,s.uX)(),(0,s.CE)("div",i,[(0,s.bF)((0,o.R1)(a.Tp))])}}}),u=t(1241);const l=(0,u.A)(c,[["__scopeId","data-v-6e8530c3"]]);var d=l,f=t(8542),m=t(4232),h=(t(4114),t(8111),t(1701),t(2261)),g=(t(2489),t(7642),t(8004),t(3853),t(5876),t(2475),t(5024),t(1698),t(9928)),v="",p="",b="",y={num_thread:10};function E(e){var n=e.baseURL,t=e.chatModel,r=e.embeddingModel;v=n,p=t,b=r}function w(e,n){return(0,f.sH)(this,void 0,Promise,(function(){var t,r,s,o;return(0,f.YH)(this,(function(a){switch(a.label){case 0:return a.trys.push([0,3,,4]),t=[{role:"system",content:n},{role:"user",content:e}],[4,fetch("".concat(v,"/api/chat"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({model:p,messages:t,stream:!1,options:y})})];case 1:if(r=a.sent(),!r.ok)throw new Error("Ollama API error: ".concat(r.status," ").concat(r.statusText));return[4,r.json()];case 2:return s=a.sent(),[2,s.message.content||""];case 3:throw o=a.sent(),console.error("Error generating keyword:",o),o;case 4:return[2]}}))}))}function L(e,n,t,r){var s,o;return void 0===r&&(r=[]),(0,f.AQ)(this,arguments,(function(){var n,a,i,c,u,l,d,m,h,g,b,E,w,L,O;return(0,f.YH)(this,(function(k){switch(k.label){case 0:return k.trys.push([0,15,,16]),n=(0,f.fX)((0,f.fX)([{role:"system",content:t}],r,!0),[{role:"user",content:e}],!1),[4,(0,f.N3)(fetch("".concat(v,"/api/chat"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({model:p,messages:n,options:y,stream:!0})}))];case 1:if(a=k.sent(),!a.ok)throw new Error("Ollama API error: ".concat(a.status," ").concat(a.statusText));if(i=null===(s=a.body)||void 0===s?void 0:s.getReader(),!i)throw new Error("レスポンスボディを読み取れません");c=new TextDecoder,u="",k.label=2;case 2:return[4,(0,f.N3)(i.read())];case 3:if(l=k.sent(),d=l.done,m=l.value,d)return[3,14];u+=c.decode(m,{stream:!0}),h=u.split("\n"),u=h.pop()||"",g=0,b=h,k.label=4;case 4:if(!(g<b.length))return[3,13];if(E=b[g],!E.trim())return[3,12];k.label=5;case 5:return k.trys.push([5,11,,12]),w=JSON.parse(E),(null===(o=w.message)||void 0===o?void 0:o.content)?[4,(0,f.N3)(w.message.content)]:[3,8];case 6:return[4,k.sent()];case 7:k.sent(),k.label=8;case 8:return w.done?[4,(0,f.N3)(void 0)]:[3,10];case 9:return[2,k.sent()];case 10:return[3,12];case 11:return L=k.sent(),console.warn("JSON解析エラー:",L),[3,12];case 12:return g++,[3,4];case 13:return[3,2];case 14:return[3,16];case 15:throw O=k.sent(),console.error("Error streaming chat message:",O),O;case 16:return[2]}}))}))}function O(e){return(0,f.sH)(this,void 0,Promise,(function(){var n,t,r;return(0,f.YH)(this,(function(s){switch(s.label){case 0:return s.trys.push([0,3,,4]),[4,fetch("".concat(v,"/api/embeddings"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({model:b,prompt:e,options:y})})];case 1:if(n=s.sent(),!n.ok)throw new Error("Ollama API error: ".concat(n.status," ").concat(n.statusText));return[4,n.json()];case 2:return t=s.sent(),[2,t.embedding||[]];case 3:throw r=s.sent(),console.error("Error generating embedding:",r),r;case 4:return[2]}}))}))}function k(){return(0,f.sH)(this,void 0,Promise,(function(){var e,n,t,r;return(0,f.YH)(this,(function(s){switch(s.label){case 0:return s.trys.push([0,3,,4]),[4,fetch("".concat(v,"/api/embeddings"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({model:b,prompt:"テスト"})})];case 1:if(e=s.sent(),!e.ok)throw new Error("Ollama API error: ".concat(e.status," ").concat(e.statusText));return[4,e.json()];case 2:return n=s.sent(),t=n.embedding.length,[2,t];case 3:throw r=s.sent(),console.error("Error getting model dimension:",r),r;case 4:return[2]}}))}))}E({baseURL:v,chatModel:p,embeddingModel:b});var S=null,T="http://localhost:11434",N="gemma3:1b",I="kun432/cl-nagoya-ruri-base:latest",M=!1,C="/v1";function _(e){var n=e.baseURL,t=e.chatModel,r=e.embeddingModel,s=e.useOllamaAPI;T=n,N=t,I=r,void 0!==s&&(M=s),S=new g.z4({baseURL:T+C,apiKey:"ollama",dangerouslyAllowBrowser:!0}),E({baseURL:T,chatModel:N,embeddingModel:I})}function R(e){var n,t,r;return(0,f.sH)(this,void 0,Promise,(function(){var s,o,a,i;return(0,f.YH)(this,(function(c){switch(c.label){case 0:if(c.trys.push([0,4,,5]),!S)throw new Error("OpenAIクライアントが初期化されていません");return s='ユーザの質問に含まれるキーワードを以下のルールで抽出してください。余分な説明は含めないでください。\n        ・キーワードをダブルクォーテーション（"）で囲む\n        ・キーワードはカンマ（,）で区切る\n        ・キーワードは文章から直接抽出し、改変しないこと\n        ・キーワードは2文字以上の単語であること\n        ・キーワードが10個より少ない場合は、今あるキーワードの同義語や関連語を追加して10個にする\n        例: "キーワード1","キーワード2","キーワード3"',M?[4,w(e,s)]:[3,2];case 1:return[2,c.sent()];case 2:return[4,S.chat.completions.create({model:N,messages:[{role:"system",content:s},{role:"user",content:e}]})];case 3:return o=c.sent(),a=null===(r=null===(t=null===(n=o.choices)||void 0===n?void 0:n[0])||void 0===t?void 0:t.message)||void 0===r?void 0:r.content,[2,a||""];case 4:throw i=c.sent(),console.error("Error generating keyword:",i),i;case 5:return[2]}}))}))}function A(e,n,t){var r,s,o;return void 0===t&&(t=[]),(0,f.AQ)(this,arguments,(function(){var a,i,c,u,l,d,m,h,g,v,p,b,y,E,w,O,k;return(0,f.YH)(this,(function(T){switch(T.label){case 0:if(T.trys.push([0,38,,39]),!S)throw new Error("OpenAIクライアントが初期化されていません");if(a=n.length>0?Array.from(new Set(n.filter((function(e){return e.filename})).map((function(e){return e.filename})))):[],i="",i=n.length>0?"与えられた参考情報を使用してユーザの質問に答えてください。\n            ・質問と直接一致する情報がない場合でも、質問の意図や類似した概念に関連する情報を探して回答してください。\n            ・回答に推測や仮定を含めないでください。\n            ・過去の会話履歴がある場合は、その内容を考慮して文脈に沿った適切な回答をしてください。\n            ・参考情報はすでに関連性が高い順に並べられています。\n            \n            参考情報：\n".concat(n.map((function(e){return e.content})).join("\n")):"ユーザの質問に答えてください。",c=(0,f.fX)((0,f.fX)([{role:"system",content:i}],t,!0),[{role:"user",content:e}],!1),!M)return[3,19];T.label=1;case 1:T.trys.push([1,8,9,14]),u=(0,f.xN)(L(e,n,i,t)),T.label=2;case 2:return[4,(0,f.N3)(u.next())];case 3:return l=T.sent(),l.done?[3,7]:(v=l.value,[4,(0,f.N3)(v)]);case 4:return[4,T.sent()];case 5:T.sent(),T.label=6;case 6:return[3,2];case 7:return[3,14];case 8:return d=T.sent(),E={error:d},[3,14];case 9:return T.trys.push([9,,12,13]),l&&!l.done&&(w=u.return)?[4,(0,f.N3)(w.call(u))]:[3,11];case 10:T.sent(),T.label=11;case 11:return[3,13];case 12:if(E)throw E.error;return[7];case 13:return[7];case 14:return a.length>0?[4,(0,f.N3)("\n\n【参考ファイル】\n".concat(a.join(", ")))]:[3,17];case 15:return[4,T.sent()];case 16:T.sent(),T.label=17;case 17:return[4,(0,f.N3)(void 0)];case 18:return[2,T.sent()];case 19:return[4,(0,f.N3)(S.chat.completions.create({model:N,messages:c,stream:!0}))];case 20:m=T.sent(),T.label=21;case 21:T.trys.push([21,28,29,34]),h=(0,f.xN)(m),T.label=22;case 22:return[4,(0,f.N3)(h.next())];case 23:return g=T.sent(),g.done?[3,27]:(v=g.value,p=null===(o=null===(s=null===(r=v.choices)||void 0===r?void 0:r[0])||void 0===s?void 0:s.delta)||void 0===o?void 0:o.content,p?[4,(0,f.N3)(p)]:[3,26]);case 24:return[4,T.sent()];case 25:T.sent(),T.label=26;case 26:return[3,22];case 27:return[3,34];case 28:return b=T.sent(),O={error:b},[3,34];case 29:return T.trys.push([29,,32,33]),g&&!g.done&&(k=h.return)?[4,(0,f.N3)(k.call(h))]:[3,31];case 30:T.sent(),T.label=31;case 31:return[3,33];case 32:if(O)throw O.error;return[7];case 33:return[7];case 34:return a.length>0?[4,(0,f.N3)("\n\n【参考ファイル】\n".concat(a.join(", ")))]:[3,37];case 35:return[4,T.sent()];case 36:T.sent(),T.label=37;case 37:return[3,39];case 38:throw y=T.sent(),console.error("Error streaming chat message:",y),y;case 39:return[2]}}))}))}function H(e){var n,t;return(0,f.sH)(this,void 0,Promise,(function(){var r,s;return(0,f.YH)(this,(function(o){switch(o.label){case 0:if(o.trys.push([0,4,,5]),!S)throw new Error("OpenAIクライアントが初期化されていません");return M?[4,O(e)]:[3,2];case 1:return[2,o.sent()];case 2:return[4,S.embeddings.create({model:I,input:e,encoding_format:"float"})];case 3:return r=o.sent(),[2,(null===(t=null===(n=r.data)||void 0===n?void 0:n[0])||void 0===t?void 0:t.embedding)||[]];case 4:throw s=o.sent(),console.error("Error generating embedding:",s),s;case 5:return[2]}}))}))}function P(){var e,n;return(0,f.sH)(this,void 0,Promise,(function(){var t,r,s;return(0,f.YH)(this,(function(o){switch(o.label){case 0:if(o.trys.push([0,4,,5]),!S)throw new Error("OpenAIクライアントが初期化されていません");return M?[4,k()]:[3,2];case 1:return[2,o.sent()];case 2:return[4,S.embeddings.create({model:I,input:"テスト",encoding_format:"float"})];case 3:return t=o.sent(),r=null===(n=null===(e=t.data)||void 0===e?void 0:e[0])||void 0===n?void 0:n.embedding.length,[2,r];case 4:throw s=o.sent(),console.error("Error getting model dimension:",s),s;case 5:return[2]}}))}))}function x(){return{baseURL:T,chatModel:N,embeddingModel:I,useOllamaAPI:M}}_({baseURL:T,chatModel:N,embeddingModel:I});t(1148);var j=t(216),U=t(3174),X=new j.Eb({extensions:{vector:U.i}});function Y(e){return(0,f.sH)(this,void 0,void 0,(function(){return(0,f.YH)(this,(function(n){switch(n.label){case 0:return[4,X.exec("CREATE EXTENSION IF NOT EXISTS vector;")];case 1:return n.sent(),[4,X.exec("\n  CREATE TABLE IF NOT EXISTS memory (\n    id SERIAL PRIMARY KEY,\n    filename TEXT,\n    section TEXT,\n    section_sequence INTEGER,\n    content TEXT NOT NULL,\n    embedding vector('".concat(e,"')\n  );\n  CREATE INDEX ON memory USING hnsw (embedding vector_cosine_ops);"))];case 2:return n.sent(),[2]}}))}))}function B(e,n,t,r,s){return(0,f.sH)(this,void 0,void 0,(function(){var o,a,i,c,u,l;return(0,f.YH)(this,(function(d){return o=JSON.stringify(n),a=e.replace(/'/g,"''"),i=o.replace(/'/g,"''"),c=t?t.replace(/'/g,"''"):null,u=r?r.replace(/'/g,"''"):null,l=void 0!==s?s:null,X.exec("INSERT INTO memory (filename, section, section_sequence, content, embedding) VALUES ('".concat(c,"', '").concat(u,"', ").concat(l,", '").concat(a,"', '").concat(i,"')")),[2]}))}))}function F(e,n){return void 0===n&&(n=3),(0,f.sH)(this,void 0,Promise,(function(){var t,r,s;return(0,f.YH)(this,(function(o){switch(o.label){case 0:return t=JSON.stringify(e),r=.3,[4,X.query("\n    SELECT id, filename, section, section_sequence, content, embedding, (embedding <=> '".concat(t,"') AS distance\n    FROM memory\n    WHERE (embedding <=> '").concat(t,"') < ").concat(r,"\n    ORDER BY distance\n    LIMIT ").concat(n,";"))];case 1:return s=o.sent(),[2,s.rows]}}))}))}function D(e,n,t){return void 0===t&&(t=3),(0,f.sH)(this,void 0,Promise,(function(){var r,s,o,a,i,c,u,l,d,m,h,g,v;return(0,f.YH)(this,(function(f){switch(f.label){case 0:if(r=JSON.stringify(n),s=.5,o=.4,a=1,i=.3,c=[],u="",l="",Array.isArray(e)){if(0===e.length||e.every((function(e){return""===e.trim()})))return[2,F(n,t)];if(d=Array.from(new Set(e.filter((function(e){return""!==e.trim()})).map((function(e){return e.trim().toLowerCase()})))),c=d.map((function(e){var n=e.replace(/'/g,"''");return"CASE WHEN LOWER(content) LIKE '%".concat(n,"%' THEN 1 ELSE 0 END")})),0===c.length)return[2,F(n,t)];m=d.map((function(e){return"content ILIKE '%".concat(e.replace(/'/g,"''"),"%'")})),l=m.join(" OR "),u="LEAST((".concat(c.join(" + "),") * ").concat(o," / ").concat(d.length,", ").concat(a,")")}else{if(h=e.replace(/'/g,"''").trim().toLowerCase(),""===h)return[2,F(n,t)];l="content ILIKE '%".concat(h,"%'"),u="CASE WHEN LOWER(content) LIKE '%".concat(h,"%' THEN ").concat(o," ELSE 0 END")}return g="\n    CASE\n      WHEN ".concat(l," THEN ").concat(u,"\n      ELSE 0\n    END + \n    (").concat(s," * (1 - (embedding <=> '").concat(r,"')))\n  "),[4,X.query("\n    WITH scored_results AS (\n      SELECT \n        id, \n        filename,\n        section,\n        section_sequence,\n        content,\n        (embedding <=> '".concat(r,"') AS vector_distance,\n        ").concat(g," AS combined_score\n      FROM memory\n    )\n    SELECT id, filename, section, section_sequence, content, vector_distance, combined_score\n    FROM scored_results\n    WHERE combined_score >= ").concat(i,"\n    ORDER BY combined_score DESC\n    LIMIT ").concat(t,";\n  "))];case 1:return v=f.sent(),[2,v.rows]}}))}))}function J(e,n){var t;return void 0===n&&(n=1e3),(0,f.sH)(this,void 0,Promise,(function(){var r,s,o,a;return(0,f.YH)(this,(function(i){switch(i.label){case 0:switch(r=null===(t=e.name.split(".").pop())||void 0===t?void 0:t.toLowerCase(),o=[],a=r,a){case"txt":return[3,1];case"md":return[3,4]}return[3,7];case 1:return[4,e.text()];case 2:return s=i.sent(),[4,K(s,n)];case 3:return o=i.sent(),[3,8];case 4:return[4,e.text()];case 5:return s=i.sent(),[4,W(s,n)];case 6:return o=i.sent(),[3,8];case 7:throw new Error("対応していないファイル形式です。: "+r);case 8:return[2,o.map((function(n){return{section:n.heading,content:n.content,filename:e.name}}))]}}))}))}function K(e,n){return(0,f.sH)(this,void 0,Promise,(function(){return(0,f.YH)(this,(function(t){return[2,q("# 無題",e,n)]}))}))}function W(e,n){return(0,f.sH)(this,void 0,Promise,(function(){var t,r,s,o,a,i,c,u,l;return(0,f.YH)(this,(function(d){for(t=[],r=e.split(/\r?\n/),s="",o=[],a=0,i=r;a<i.length;a++)c=i[a],c.startsWith("# ")?(s&&(u=o.join("\n").trim(),l=q(s,u,n),t.push.apply(t,l)),s=c,o=[]):o.push(c);return s&&(u=o.join("\n").trim(),l=q(s,u,n),t.push.apply(t,l)),!s&&o.length>0&&(u=o.join("\n").trim(),u&&(l=q("# 無題",u,n),t.push.apply(t,l))),[2,t]}))}))}function q(e,n,t){if(n.length<=t)return[{heading:e,content:n}];for(var r=[],s=n.split("\n"),o="",a=0,i=s;a<i.length;a++){var c=i[a];o.length+c.length+1>t?(o.trim()&&r.push({heading:e,content:o.trim()}),o=c):o+=(o?"\n":"")+c}return o.trim()&&r.push({heading:e,content:o.trim()}),r}var V=(0,h.nY)("chat",{state:function(){return{messageList:new Map,isLoading:!1}},getters:{},actions:{addMessage:function(e,n){void 0===n&&(n=!1);var t=this.messageList.size+1;this.messageList.set(t,{id:t,message:e,isBot:n})},getBotReply:function(e){var n,t,r;return(0,f.sH)(this,void 0,void 0,(function(){var s,o,a,i,c,u,l,d,m,h,g,v,p,b,y,E,w,L;return(0,f.YH)(this,(function(O){switch(O.label){case 0:return s=this.messageList.size+1,o=Date.now(),this.messageList.set(s,{id:s,message:"",isBot:!0,isStreaming:!0,streamingStartTime:o}),[4,R(e)];case 1:return a=O.sent(),console.log("Generated keywords:",a),i=a.split(",").map((function(e){return e.trim().replace(/^"|"$/g,"")})),[4,H(e).catch((function(e){return z(e),[]}))];case 2:return c=O.sent(),[4,D(i,c).catch((function(e){return z(e),[]}))];case 3:for(u=O.sent(),console.log("searchMemory result:",u),l=[],d=Array.from(this.messageList.values()).sort((function(e,n){return e.id-n.id})).slice(-10),m=0,h=d;m<h.length;m++)g=h[m],l.push({role:g.isBot?"assistant":"user",content:g.message});O.label=4;case 4:O.trys.push([4,17,18,19]),O.label=5;case 5:O.trys.push([5,10,11,16]),v=(0,f.xN)(A(e,u,l)),O.label=6;case 6:return[4,v.next()];case 7:if(p=O.sent(),p.done)return[3,9];b=p.value,y=(null===(r=this.messageList.get(s))||void 0===r?void 0:r.message)||"",this.messageList.set(s,{id:s,message:y+b,isBot:!0,isStreaming:!1,streamingStartTime:void 0,responseTime:(Date.now()-o)/1e3}),O.label=8;case 8:return[3,6];case 9:return[3,16];case 10:return E=O.sent(),n={error:E},[3,16];case 11:return O.trys.push([11,,14,15]),p&&!p.done&&(t=v.return)?[4,t.call(v)]:[3,13];case 12:O.sent(),O.label=13;case 13:return[3,15];case 14:if(n)throw n.error;return[7];case 15:return[7];case 16:return[3,19];case 17:return w=O.sent(),z(w),L=this.messageList.get(s),L&&this.messageList.set(s,(0,f.Cl)((0,f.Cl)({},L),{isStreaming:!1,streamingStartTime:void 0,responseTime:(Date.now()-o)/1e3})),[3,19];case 18:return this.isLoading=!1,[7];case 19:return[2]}}))}))},uploadFile:function(e){return(0,f.sH)(this,void 0,void 0,(function(){var n,t,r,s,o,a,i,c,u,l,d,m;return(0,f.YH)(this,(function(h){switch(h.label){case 0:n=this.messageList.size+1,t=Date.now(),this.messageList.set(n,{id:n,message:"",isBot:!0,isStreaming:!0,streamingStartTime:t,isFileUpload:!0}),h.label=1;case 1:return h.trys.push([1,8,9,10]),[4,J(e,500).catch((function(e){return z(e),[]}))];case 2:r=h.sent(),s=new Map,o=0,a=r,h.label=3;case 3:return o<a.length?(i=a[o],console.log("Processing chunk:",i.content),[4,H(i.content).catch((function(e){return z(e)}))]):[3,7];case 4:return c=h.sent(),c?(u="".concat(i.filename||"unknown","_").concat(i.section||"unknown"),l=s.get(u)||0,[4,B(i.content,c,i.filename,i.section,l).catch((function(e){return z(e)}))]):[3,6];case 5:h.sent(),s.set(u,l+1),h.label=6;case 6:return o++,[3,3];case 7:return this.messageList.set(n,{id:n,message:"ファイルのアップロードが完了しました。",isBot:!0,isStreaming:!1,streamingStartTime:void 0,responseTime:(Date.now()-t)/1e3,isFileUpload:!0}),[3,10];case 8:return d=h.sent(),z(d),m=this.messageList.get(n),m&&this.messageList.set(n,(0,f.Cl)((0,f.Cl)({},m),{message:"ファイルのアップロードに失敗しました。",isStreaming:!1,streamingStartTime:void 0,responseTime:(Date.now()-t)/1e3,isFileUpload:!0})),[3,10];case 9:return this.isLoading=!1,[7];case 10:return[2]}}))}))}}}),z=function(e){e instanceof Error?console.error(e.message,e.stack):console.error("Error occured.",e)},Q={class:"file-upload-label"},G=["disabled"],$=["disabled"],Z=(0,s.pM)({__name:"ChatForm",setup:function(e){var n=this,t=V(),a=(0,o.KR)(""),i=(0,o.KR)(null),c=(0,o.KR)(null),u=(0,s.EW)((function(){return t.isLoading})),l=function(){t.isLoading=!0,t.addMessage(a.value),t.getBotReply(a.value),a.value=""},d=function(){var e;null===(e=c.value)||void 0===e||e.click()},m=function(e){return(0,f.sH)(n,void 0,void 0,(function(){var n;return(0,f.YH)(this,(function(r){switch(r.label){case 0:return n=e.target,n.files&&n.files.length>0?(i.value=n.files[0],t.isLoading=!0,t.addMessage("ファイルを参考情報としてロードします。: ".concat(i.value.name),!0),[4,t.uploadFile(i.value)]):[3,2];case 1:r.sent(),i.value=null,r.label=2;case 2:return[2]}}))}))};return(0,s.$u)((function(){window.scrollTo({top:document.body.scrollHeight,behavior:"smooth"})})),function(e,n){return(0,s.uX)(),(0,s.CE)("form",{onSubmit:(0,r.D$)(l,["prevent"]),class:"send-form"},[(0,s.Lk)("label",Q,[(0,s.Lk)("input",{ref_key:"fileInputRef",ref:c,type:"file",onChange:m,class:"file-input",style:{display:"none"}},null,544),(0,s.Lk)("button",{type:"button",onClick:d,disabled:u.value,class:"submit-btn"},"RAG追加",8,G)]),(0,s.bo)((0,s.Lk)("input",{type:"text",id:"sendMessage","onUpdate:modelValue":n[0]||(n[0]=function(e){return a.value=e}),required:"",class:"input-text"},null,512),[[r.Jo,a.value]]),(0,s.Lk)("button",{type:"submit",disabled:u.value,class:"submit-btn"},"送信",8,$)],32)}}});const ee=Z;var ne=ee,te={class:"container"},re={key:0},se={key:1},oe={style:{"margin-top":"8px"}},ae={for:"useOllamaAPI-checkbox",class:"sidebar-label"},ie={class:"messages-container"},ce={key:0,class:"bot-message"},ue={key:0,class:"loading-container"},le={class:"loading-text"},de={key:0,class:"loading-timer"},fe={key:1},me=["innerHTML"],he={key:0,class:"response-time"},ge={key:1,class:"user-message"},ve={key:0,class:"chat-form-bottom"},pe=(0,s.pM)({__name:"BotBox",setup:function(e){var n=V(),t=(0,s.EW)((function(){return n.messageList})),a=(0,o.KR)(!1),i=(0,o.KR)(null),c=(0,o.KR)(Date.now()),u=null;(0,s.sV)((function(){u=setInterval((function(){c.value=Date.now()}),100)})),(0,s.hi)((function(){u&&clearInterval(u)}));var l=function(e){var n=(c.value-e)/1e3;return n.toFixed(1)},d=function(e){return e.isFileUpload?"ファイルをアップロードしています...":"回答を生成中..."},h=function(){if(i.value){var e=i.value.querySelector(".messages-container");e&&(e.scrollTop=e.scrollHeight)}};function g(){var e=localStorage.getItem("openai_config");if(e)try{return JSON.parse(e)}catch(n){}return x()}var v=(0,o.KR)(g()),p=(0,o.KR)(!0);function b(){p.value=!p.value}function y(){_({baseURL:v.value.baseURL,chatModel:v.value.chatModel,embeddingModel:v.value.embeddingModel,useOllamaAPI:v.value.useOllamaAPI}),localStorage.setItem("openai_config",JSON.stringify(v.value)),window.alert("設定を更新しました"),window.location.reload()}(0,s.wB)(v,(function(e){localStorage.setItem("openai_config",JSON.stringify(e))}),{deep:!0});var E=x();function w(){v.value=(0,f.Cl)({},E),_((0,f.Cl)((0,f.Cl)({},E),{useOllamaAPI:E.useOllamaAPI})),localStorage.setItem("openai_config",JSON.stringify(E)),window.alert("デフォルト設定に戻しました"),window.location.reload()}function L(e){return e.replace(/\n/g,"<br>")}return(0,s.sV)((function(){_({baseURL:v.value.baseURL,chatModel:v.value.chatModel,embeddingModel:v.value.embeddingModel,useOllamaAPI:v.value.useOllamaAPI}),P().then((function(e){console.log("Embedding dimension:",e),Y(e).then((function(){console.log("Memory initialized successfully."),a.value=!0})).catch((function(e){console.error("Error initializing memory:",e),window.alert("Memory initialization failed. Please check the console for details.")}))})).catch((function(e){console.error("Error getting embedding dimension:",e),window.alert("Embedding model initialization failed. Please check the console for details.")}))})),(0,s.wB)(t,(function(){(0,s.dY)((function(){h()}))}),{deep:!0}),function(e,n){return(0,s.uX)(),(0,s.CE)("div",te,[(0,s.Lk)("div",{class:(0,m.C4)(["sidebar",{closed:!p.value}])},[(0,s.Lk)("button",{class:"sidebar-toggle",onClick:b},[p.value?((0,s.uX)(),(0,s.CE)("span",re,"＜")):((0,s.uX)(),(0,s.CE)("span",se,"≡"))]),n[8]||(n[8]=(0,s.eW)()),p.value?((0,s.uX)(),(0,s.CE)(s.FK,{key:0},[n[5]||(n[5]=(0,s.Lk)("label",{for:"baseURL-input",class:"sidebar-label"},"ollama baseURL:",-1)),(0,s.bo)((0,s.Lk)("input",{id:"baseURL-input","onUpdate:modelValue":n[0]||(n[0]=function(e){return v.value.baseURL=e}),class:"sidebar-input"},null,512),[[r.Jo,v.value.baseURL]]),n[6]||(n[6]=(0,s.Lk)("label",{for:"chatModel-input",class:"sidebar-label"},"chatModel:",-1)),(0,s.bo)((0,s.Lk)("input",{id:"chatModel-input","onUpdate:modelValue":n[1]||(n[1]=function(e){return v.value.chatModel=e}),class:"sidebar-input"},null,512),[[r.Jo,v.value.chatModel]]),n[7]||(n[7]=(0,s.Lk)("label",{for:"embeddingModel-input",class:"sidebar-label"},"embeddingModel:",-1)),(0,s.bo)((0,s.Lk)("input",{id:"embeddingModel-input","onUpdate:modelValue":n[2]||(n[2]=function(e){return v.value.embeddingModel=e}),class:"sidebar-input"},null,512),[[r.Jo,v.value.embeddingModel]]),(0,s.Lk)("div",oe,[(0,s.Lk)("label",ae,[(0,s.bo)((0,s.Lk)("input",{id:"useOllamaAPI-checkbox","onUpdate:modelValue":n[3]||(n[3]=function(e){return v.value.useOllamaAPI=e}),type:"checkbox",style:{"margin-right":"8px"}},null,512),[[r.lH,v.value.useOllamaAPI]]),n[4]||(n[4]=(0,s.eW)(" OllamaAPI使用 "))])]),(0,s.Lk)("div",{style:{"margin-top":"8px",display:"flex","justify-content":"space-between"}},[(0,s.Lk)("button",{onClick:w,class:"config-btn reset-btn",title:"デフォルト設定に戻します"},"リセット"),(0,s.Lk)("button",{onClick:y,class:"config-btn",title:"設定を適用します"},"適用")])],64)):(0,s.Q3)("",!0)],2),(0,s.Lk)("div",{class:"main-content",ref_key:"containerRef",ref:i},[(0,s.Lk)("div",ie,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(t.value,(function(e){var t=e[0],r=e[1];return(0,s.uX)(),(0,s.CE)("div",{key:t,class:(0,m.C4)(["message-wrapper",{user:!r.isBot}])},[r.isBot?((0,s.uX)(),(0,s.CE)("div",ce,[r.isStreaming&&!r.message?((0,s.uX)(),(0,s.CE)("div",ue,[n[9]||(n[9]=(0,s.Lk)("div",{class:"loading-spinner"},null,-1)),(0,s.Lk)("span",le,[(0,s.eW)((0,m.v_)(d(r))+" ",1),r.streamingStartTime?((0,s.uX)(),(0,s.CE)("span",de," ("+(0,m.v_)(l(r.streamingStartTime))+"秒) ",1)):(0,s.Q3)("",!0)])])):((0,s.uX)(),(0,s.CE)("div",fe,[(0,s.Lk)("div",{innerHTML:L(r.message)},null,8,me),r.responseTime?((0,s.uX)(),(0,s.CE)("div",he," (応答時間: "+(0,m.v_)(r.responseTime.toFixed(1))+"秒) ",1)):(0,s.Q3)("",!0)]))])):((0,s.uX)(),(0,s.CE)("div",ge,(0,m.v_)(r.message),1))],2)})),128))]),a.value?((0,s.uX)(),(0,s.CE)("div",ve,[(0,s.bF)(ne)])):(0,s.Q3)("",!0)],512)])}}});const be=pe;var ye=be,Ee=[{path:"/",name:"Top",component:ye}],we=(0,a.aE)({history:(0,a.Bt)(),routes:Ee}),Le=we,Oe=(0,r.Ef)(d),ke=(0,h.Ey)();Oe.use(ke),Oe.use(Le),Oe.mount("#app")}},n={};function t(r){var s=n[r];if(void 0!==s)return s.exports;var o=n[r]={exports:{}};return e[r].call(o.exports,o,o.exports,t),o.exports}t.m=e,function(){var e=[];t.O=function(n,r,s,o){if(!r){var a=1/0;for(l=0;l<e.length;l++){r=e[l][0],s=e[l][1],o=e[l][2];for(var i=!0,c=0;c<r.length;c++)(!1&o||a>=o)&&Object.keys(t.O).every((function(e){return t.O[e](r[c])}))?r.splice(c--,1):(i=!1,o<a&&(a=o));if(i){e.splice(l--,1);var u=s();void 0!==u&&(n=u)}}return n}o=o||0;for(var l=e.length;l>0&&e[l-1][2]>o;l--)e[l]=e[l-1];e[l]=[r,s,o]}}(),function(){t.n=function(e){var n=e&&e.__esModule?function(){return e["default"]}:function(){return e};return t.d(n,{a:n}),n}}(),function(){var e,n=Object.getPrototypeOf?function(e){return Object.getPrototypeOf(e)}:function(e){return e.__proto__};t.t=function(r,s){if(1&s&&(r=this(r)),8&s)return r;if("object"===typeof r&&r){if(4&s&&r.__esModule)return r;if(16&s&&"function"===typeof r.then)return r}var o=Object.create(null);t.r(o);var a={};e=e||[null,n({}),n([]),n(n)];for(var i=2&s&&r;"object"==typeof i&&!~e.indexOf(i);i=n(i))Object.getOwnPropertyNames(i).forEach((function(e){a[e]=function(){return r[e]}}));return a["default"]=function(){return r},t.d(o,a),o}}(),function(){t.d=function(e,n){for(var r in n)t.o(n,r)&&!t.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:n[r]})}}(),function(){t.f={},t.e=function(e){return Promise.all(Object.keys(t.f).reduce((function(n,r){return t.f[r](e,n),n}),[]))}}(),function(){t.u=function(e){return"assets/js/"+e+"."+{40:"5b50ed63",97:"2a128f07",193:"6e4e4550",330:"99cf8ebc",574:"562fddda",622:"417fc63b",675:"0e734134",811:"414046d9",835:"b5ca7d4d"}[e]+".js"}}(),function(){t.miniCssF=function(e){}}(),function(){t.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){t.o=function(e,n){return Object.prototype.hasOwnProperty.call(e,n)}}(),function(){var e={},n="pglite_vector_search:";t.l=function(r,s,o,a){if(e[r])e[r].push(s);else{var i,c;if(void 0!==o)for(var u=document.getElementsByTagName("script"),l=0;l<u.length;l++){var d=u[l];if(d.getAttribute("src")==r||d.getAttribute("data-webpack")==n+o){i=d;break}}i||(c=!0,i=document.createElement("script"),i.charset="utf-8",i.timeout=120,t.nc&&i.setAttribute("nonce",t.nc),i.setAttribute("data-webpack",n+o),i.src=r),e[r]=[s];var f=function(n,t){i.onerror=i.onload=null,clearTimeout(m);var s=e[r];if(delete e[r],i.parentNode&&i.parentNode.removeChild(i),s&&s.forEach((function(e){return e(t)})),n)return n(t)},m=setTimeout(f.bind(null,void 0,{type:"timeout",target:i}),12e4);i.onerror=f.bind(null,i.onerror),i.onload=f.bind(null,i.onload),c&&document.head.appendChild(i)}}}(),function(){t.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}}(),function(){t.p="/PGLiteVectorSearch/"}(),function(){t.b=document.baseURI||self.location.href;var e={524:0};t.f.j=function(n,r){var s=t.o(e,n)?e[n]:void 0;if(0!==s)if(s)r.push(s[2]);else{var o=new Promise((function(t,r){s=e[n]=[t,r]}));r.push(s[2]=o);var a=t.p+t.u(n),i=new Error,c=function(r){if(t.o(e,n)&&(s=e[n],0!==s&&(e[n]=void 0),s)){var o=r&&("load"===r.type?"missing":r.type),a=r&&r.target&&r.target.src;i.message="Loading chunk "+n+" failed.\n("+o+": "+a+")",i.name="ChunkLoadError",i.type=o,i.request=a,s[1](i)}};t.l(a,c,"chunk-"+n,n)}},t.O.j=function(n){return 0===e[n]};var n=function(n,r){var s,o,a=r[0],i=r[1],c=r[2],u=0;if(a.some((function(n){return 0!==e[n]}))){for(s in i)t.o(i,s)&&(t.m[s]=i[s]);if(c)var l=c(t)}for(n&&n(r);u<a.length;u++)o=a[u],t.o(e,o)&&e[o]&&e[o][0](),e[o]=0;return t.O(l)},r=self["webpackChunkpglite_vector_search"]=self["webpackChunkpglite_vector_search"]||[];r.forEach(n.bind(null,0)),r.push=n.bind(null,r.push.bind(r))}();var r=t.O(void 0,[504],(function(){return t(9645)}));r=t.O(r)})();
//# sourceMappingURL=app.6046bb42.js.map